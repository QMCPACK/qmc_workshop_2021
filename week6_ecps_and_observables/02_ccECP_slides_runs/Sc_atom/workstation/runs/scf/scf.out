#INFO: **** input file is /home/qmcuser/repos/qmc_workshop_2021/week6_ecps_and_observables/02_ccECP_slides_runs/Sc_atom/workstation/runs/scf/scf.py ****
#!/usr/bin/env python3

import sys, os
from pyscf import scf, gto
import numpy as np
from urllib.request import urlretrieve

### Set the current working directory
cwd = os.getcwd()
pplib = "http://pseudopotentiallibrary.org/recipes"
pptype = "ccECP"

### Retrieve basis and ECP files from pseudopotentiallibrary.org
atom1 = "Sc"
bastype1 = "cc-pVTZ"
basfile1 = "{0}.{1}.nwchem".format(atom1,bastype1)
ecpfile1 = "{0}.{1}.nwchem".format(atom1,pptype)
xmlfile1 = "{0}.{1}.xml".format(atom1,pptype)
urlretrieve("{0}/{1}/{2}/{3}".format(pplib,atom1,pptype,basfile1), filename=basfile1)
urlretrieve("{0}/{1}/{2}/{3}".format(pplib,atom1,pptype,ecpfile1), filename=ecpfile1)
urlretrieve("{0}/{1}/{2}/{3}".format(pplib,atom1,pptype,xmlfile1), filename=xmlfile1)

###~~~~ Build the molecule ~~~~

# Nexus expands this with Mole info

### generated system text ###
from pyscf import gto as gto_loc
mol = gto_loc.Mole()
mol.verbose  = 4
mol.atom     = '''
               Sc   0.00000000   0.00000000   0.00000000
               '''
mol.unit     = 'A'
mol.charge   = 0
mol.spin     = 1
mol.symmetry = 'D2h'
mol.build()
### end generated system text ###



with open(os.path.join(cwd,basfile1)) as f:
    bas1 = f.read()
with open(os.path.join(cwd,ecpfile1)) as f:
    ecp1 = f.read()
mol.basis = {atom1: gto.basis.parse(bas1)} 
mol.ecp = {atom1: gto.basis.parse_ecp(ecp1)}
mol.build()

#~~~Run HF on molecule~~~~
mf = scf.ROHF(mol)
mf.irrep_nelec = {
'Ag' : (3,2),   # s    
'B3u': (1,1),   # x    1
'B1u': (1,1),   # z    0
'B2u': (1,1),   # y   -1
'B2g': (0,0),   # xz   1
'B3g': (0,0),   # yz  -1
'B1g': (0,0),   # xy  -2
'Au' : (0,0)    # xyz  
}
mf.max_cycle=100
mf.chkfile='scf.chkfile'
en=mf.kernel()
mf.analyze()


### generated conversion text ###
from PyscfToQmcpack import savetoqmcpack
savetoqmcpack(mol,mf,'scf')
### end generated conversion text ###

#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='WorkshopVBX', release='5.11.0-37-generic', version='#41~20.04.2-Ubuntu SMP Fri Sep 24 09:06:38 UTC 2021', machine='x86_64', processor='x86_64')  Threads 1
Python 3.8.10 (default, Sep 28 2021, 16:10:42) 
[GCC 9.3.0]
numpy 1.21.2  scipy 1.7.1
Date: Thu Oct 21 19:02:26 2021
PySCF version 2.0.0a
PySCF path  /home/qmcuser/apps/pyscf/pyscf/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 1
[INPUT] num. electrons = 21
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 1
[INPUT] symmetry D2h subgroup None
[INPUT] Mole.unit = A
[INPUT]  1 Sc     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr

nuclear repulsion = 0
point group symmetry = SO3, use subgroup D2h
num. orbitals of irrep Ag = 6
num. orbitals of irrep B1g = 1
num. orbitals of irrep B2g = 1
num. orbitals of irrep B3g = 1
num. orbitals of irrep B1u = 3
num. orbitals of irrep B2u = 3
num. orbitals of irrep B3u = 3
number of shells = 8
number of NR pGTOs = 54
number of NR cGTOs = 18
basis = sto-3g
ecp = {}
CPU time:         0.44


******** <class 'pyscf.scf.hf_symm.SymAdaptedROHF'> ********
method = SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 100
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = scf.chkfile
max_memory 4000 MB (current use 75 MB)
num. doubly occ = 5  num. singly occ = 1
irrep_nelec {'Ag': (3, 2), 'B3u': (1, 1), 'B1u': (1, 1), 'B2u': (1, 1), 'B2g': (0, 0), 'B3g': (0, 0), 'B1g': (0, 0), 'Au': (0, 0)}
Freeze 11 electrons in irreps ['Ag', 'B3u', 'B1u', 'B2u', 'B2g', 'B3g', 'B1g', 'Au']
    0 free electrons in irreps 
Set gradient conv threshold to 3.16228e-05
init E= -45.9136649685999
HOMO (Ag) = -0.0577234179304876  LUMO (B1g) = -0.0577234179304878
cycle= 1 E= -46.0897428002529  delta_E= -0.176  |g|= 0.343  |ddm|= 1.13
HOMO (Ag) = 0.00381681909022082  LUMO (B1u) = 0.0283124195409588
cycle= 2 E= -46.1168914410183  delta_E= -0.0271  |g|= 0.0641  |ddm|= 0.312
HOMO (Ag) = -0.0561785194438898  LUMO (B1u) = 0.0234629682046566
cycle= 3 E= -46.1201302543183  delta_E= -0.00324  |g|= 0.0332  |ddm|= 0.315
HOMO (Ag) = -0.0552126698109282  LUMO (B1u) = 0.0219163591959276
cycle= 4 E= -46.1204691152501  delta_E= -0.000339  |g|= 0.0241  |ddm|= 0.24
HOMO (Ag) = -0.0518838356213264  LUMO (B1u) = 0.0214669434128584
cycle= 5 E= -46.1218363880115  delta_E= -0.00137  |g|= 0.00259  |ddm|= 0.122
HOMO (Ag) = -0.0500588912568182  LUMO (B1u) = 0.0213554475940128
cycle= 6 E= -46.121843304638  delta_E= -6.92e-06  |g|= 0.000757  |ddm|= 0.0101
HOMO (Ag) = -0.0509518827530611  LUMO (B1u) = 0.0212050793227139
cycle= 7 E= -46.1218443594304  delta_E= -1.05e-06  |g|= 0.000313  |ddm|= 0.00445
HOMO (Ag) = -0.0509567751733827  LUMO (B1u) = 0.0212149947206224
cycle= 8 E= -46.1218446537702  delta_E= -2.94e-07  |g|= 0.000185  |ddm|= 0.00248
HOMO (Ag) = -0.0508694994303132  LUMO (B1u) = 0.0212306616635095
cycle= 9 E= -46.1218447899458  delta_E= -1.36e-07  |g|= 9.74e-05  |ddm|= 0.0014
HOMO (Ag) = -0.0508965368461136  LUMO (B1u) = 0.0212285623929879
cycle= 10 E= -46.1218448311406  delta_E= -4.12e-08  |g|= 9.54e-05  |ddm|= 0.000486
HOMO (Ag) = -0.0508977355211316  LUMO (B1u) = 0.0212288030451543
cycle= 11 E= -46.1218448562425  delta_E= -2.51e-08  |g|= 9.44e-05  |ddm|= 0.00027
HOMO (Ag) = -0.0508955601561379  LUMO (B1u) = 0.0212287436907004
cycle= 12 E= -46.1218448329677  delta_E= 2.33e-08  |g|= 9.35e-05  |ddm|= 0.000251
HOMO (Ag) = -0.050898662965951  LUMO (B1u) = 0.0212283388081468
cycle= 13 E= -46.1218447314045  delta_E= 1.02e-07  |g|= 9.25e-05  |ddm|= 0.00111
HOMO (Ag) = -0.0509104894105161  LUMO (B1u) = 0.0212264329578847
cycle= 14 E= -46.121844399262  delta_E= 3.32e-07  |g|= 8.51e-05  |ddm|= 0.00386
HOMO (Ag) = -0.051000011874167  LUMO (B1u) = 0.0212250867300357
cycle= 15 E= -46.1218431224476  delta_E= 1.28e-06  |g|= 9.55e-05  |ddm|= 0.0293
HOMO (Ag) = -0.0509547699660102  LUMO (B1u) = 0.0212242437984697
cycle= 16 E= -46.1218432444248  delta_E= -1.22e-07  |g|= 6.04e-05  |ddm|= 0.00754
HOMO (Ag) = -0.0509585972815355  LUMO (B1u) = 0.0212243553344428
cycle= 17 E= -46.1218431880032  delta_E= 5.64e-08  |g|= 5.88e-05  |ddm|= 0.00259
HOMO (Ag) = -0.0509107349228779  LUMO (B1u) = 0.0212253780884483
cycle= 18 E= -46.1218431832014  delta_E= 4.8e-09  |g|= 2.77e-05  |ddm|= 0.000435
HOMO (Ag) = -0.0509070930317695  LUMO (B1u) = 0.0212273648852208
cycle= 19 E= -46.1218431258638  delta_E= 5.73e-08  |g|= 1.38e-05  |ddm|= 0.00564
HOMO (Ag) = -0.050898846999361  LUMO (B1u) = 0.0212271143583243
cycle= 20 E= -46.1218431241658  delta_E= 1.7e-09  |g|= 4.69e-06  |ddm|= 0.00133
HOMO (Ag) = -0.0508935408707206  LUMO (B1u) = 0.0212270149045875
cycle= 21 E= -46.1218431242096  delta_E= -4.38e-11  |g|= 2.45e-06  |ddm|= 0.000252
HOMO (Ag) = -0.0508962030546289  LUMO (B1u) = 0.0212268097040155
Extra cycle  E= -46.1218431242  delta_E= 9.59e-12  |g|= 3.06e-06  |ddm|= 2.48e-05
converged SCF energy = -46.1218431242
**** SCF Summaries ****
Total Energy =                         -46.121843124199962
Nuclear Repulsion Energy =               0.000000000000000
One-electron Energy =                  -76.798899376451828
Two-electron Energy =                   30.677056252251866
Wave-function symmetry = Ag
occupancy for each irrep:     Ag  B1g  B2g  B3g   Au  B1u  B2u  B3u
double occ                     2    0    0    0    0    1    1    1
single occ                     1    0    0    0    0    0    0    0
**** MO energy ****
                          Roothaan           | alpha              | beta
MO #1   (Ag  #1 ) energy= -2.59527638916388  | -2.62444171967823  | -2.56611105864817  occ= 2
MO #2   (B1u #1 ) energy= -1.58555423511961  | -1.59253775617786  | -1.57857071406136  occ= 2
MO #3   (B2u #1 ) energy= -1.57875477121604  | -1.63032319758823  | -1.52718634484385  occ= 2
MO #4   (B3u #1 ) energy= -1.57875294458675  | -1.63033291996826  | -1.52717296920524  occ= 2
MO #5   (Ag  #2 ) energy= -0.210834761826843 | -0.215124662733219 | -0.206544860920648 occ= 2
MO #6   (Ag  #3 ) energy= -0.0508962030546289 | -0.346451770476666 | 0.244660433709198  occ= 1
MO #7   (B1u #2 ) energy= 0.0212268097040155 | 0.0209454204294481 | 0.0215081989785831 occ= 0
MO #8   (B2u #2 ) energy= 0.0244128318225817 | 0.0228039080946013 | 0.0260217555505609 occ= 0
MO #9   (B3u #2 ) energy= 0.0244136317197808 | 0.0228042910984765 | 0.0260229723410851 occ= 0
MO #10  (Ag  #4 ) energy= 0.0638802066053453 | 0.0633193310169631 | 0.0644410821861597 occ= 0
MO #11  (B3g #1 ) energy= 0.0642678211116122 | 0.0638576562533462 | 0.0646779859698782 occ= 0
MO #12  (B2g #1 ) energy= 0.064268121194949  | 0.063858018770184  | 0.0646782236197145 occ= 0
MO #13  (B1g #1 ) energy= 0.0652727369227893 | 0.0651170468266019 | 0.0654284270189764 occ= 0
MO #14  (Ag  #5 ) energy= 0.0704555780956778 | 0.0694975525292786 | 0.0714128549944454 occ= 0
MO #15  (Ag  #6 ) energy= 0.122021065429094  | 0.120586042179089  | 0.123456088684288  occ= 0
MO #16  (B1u #3 ) energy= 0.135137953264869  | 0.134620335337403  | 0.135655571192335  occ= 0
MO #17  (Ag  #7 ) energy= 0.138595507226559  | 0.130603344671715  | 0.146587669777296  occ= 0
MO #18  (B2u #3 ) energy= 0.13945839239557   | 0.136344464655509  | 0.142572320135631  occ= 0
MO #19  (B3u #3 ) energy= 0.139459491328629  | 0.136344739243665  | 0.142574243413593  occ= 0
MO #20  (B3g #2 ) energy= 0.142691712621148  | 0.136394542631327  | 0.148988882610969  occ= 0
MO #21  (B2g #2 ) energy= 0.142695045660284  | 0.136398413450503  | 0.148991677870066  occ= 0
MO #22  (B1g #2 ) energy= 0.155931501426283  | 0.152734454931239  | 0.159128547921327  occ= 0
MO #23  (Ag  #8 ) energy= 0.298051145085075  | 0.282375242441784  | 0.313726841852114  occ= 0
MO #24  (Ag  #9 ) energy= 0.344232472512163  | 0.338115471180576  | 0.350349473843457  occ= 0
MO #25  (B3g #3 ) energy= 0.348269421400538  | 0.342825455362584  | 0.353713387438493  occ= 0
MO #26  (B2g #3 ) energy= 0.348272459513258  | 0.342828797186971  | 0.353716121839546  occ= 0
MO #27  (B1g #3 ) energy= 0.361103525308208  | 0.357679145059936  | 0.364527905556481  occ= 0
MO #28  (B1u #4 ) energy= 0.559639924190642  | 0.558439558599598  | 0.560840289781686  occ= 0
MO #29  (B2u #4 ) energy= 0.569424491672195  | 0.562713737520769  | 0.576135245823619  occ= 0
MO #30  (B3u #4 ) energy= 0.569427002914225  | 0.562714958356134  | 0.576139047472315  occ= 0
MO #31  (B1u #5 ) energy= 0.620700523002388  | 0.618916984948515  | 0.622484061056261  occ= 0
MO #32  (B2u #5 ) energy= 0.620974297576203  | 0.617462899046776  | 0.62448569610563   occ= 0
MO #33  (B3u #5 ) energy= 0.620975367781424  | 0.61746286545569   | 0.624487870107159  occ= 0
MO #34  (B1u #6 ) energy= 0.621659917625642  | 0.614924687016508  | 0.628395148234778  occ= 0
MO #35  (Au  #1 ) energy= 0.623227259907979  | 0.622633792852013  | 0.623820726963944  occ= 0
MO #36  (B3u #6 ) energy= 0.624680369657952  | 0.617724312567164  | 0.631636426748741  occ= 0
MO #37  (B2u #6 ) energy= 0.624680589120604  | 0.617724418857556  | 0.631636759383654  occ= 0
MO #38  (Ag  #10) energy= 0.797079666970721  | 0.790472920871351  | 0.803686413068378  occ= 0
MO #39  (Ag  #11) energy= 1.24135877789005   | 1.18997479704531   | 1.29274264301203   occ= 0
MO #40  (Ag  #12) energy= 1.26491679329419   | 1.25821106473804   | 1.27162252185014   occ= 0
MO #41  (B3g #4 ) energy= 1.26984709153069   | 1.26410266255892   | 1.27559152050246   occ= 0
MO #42  (B2g #4 ) energy= 1.26985089062669   | 1.26410685139243   | 1.27559492986094   occ= 0
MO #43  (B1g #4 ) energy= 1.28562951640367   | 1.28198678632001   | 1.28927224648733   occ= 0
MO #44  (Ag  #13) energy= 1.90556091421666   | 1.90307055076439   | 1.90805127766896   occ= 0
MO #45  (B3g #5 ) energy= 1.90621160230193   | 1.90395450449542   | 1.90846870010843   occ= 0
MO #46  (B2g #5 ) energy= 1.90621297601156   | 1.90395679405809   | 1.90846915796504   occ= 0
MO #47  (B1g #5 ) energy= 1.90746470314776   | 1.90637998956504   | 1.90854941673048   occ= 0
MO #48  (Ag  #14) energy= 1.91038125692955   | 1.90360279193112   | 1.91715972286023   occ= 0
MO #49  (B3g #6 ) energy= 1.91366651362013   | 1.9068103822111    | 1.92052264502917   occ= 0
MO #50  (B2g #6 ) energy= 1.91366731231907   | 1.90680950376258   | 1.92052512087556   occ= 0
MO #51  (B1g #6 ) energy= 1.92048821169891   | 1.91004394142866   | 1.93093248196916   occ= 0
MO #52  (Ag  #15) energy= 1.92059221903703   | 1.90986337278654   | 1.9313210652876    occ= 0
MO #53  (B1u #7 ) energy= 1.99224319749129   | 1.98965536304166   | 1.99483103194091   occ= 0
MO #54  (B2u #7 ) energy= 2.01363733302257   | 2.00146296234379   | 2.02581170370135   occ= 0
MO #55  (B3u #7 ) energy= 2.01364254850541   | 2.00146582289414   | 2.02581927411668   occ= 0
MO #56  (B1u #8 ) energy= 2.37259656327417   | 2.3654336937867    | 2.37975943276164   occ= 0
MO #57  (B2u #8 ) energy= 2.37314698168768   | 2.35639666454993   | 2.38989729882542   occ= 0
MO #58  (B3u #8 ) energy= 2.37314951874573   | 2.35639196187574   | 2.38990707561571   occ= 0
MO #59  (B1u #9 ) energy= 2.37425886835628   | 2.34694513557125   | 2.4015726011413    occ= 0
MO #60  (Au  #2 ) energy= 2.38253496119759   | 2.37989953626874   | 2.38517038612644   occ= 0
MO #61  (B2u #9 ) energy= 2.38408351274351   | 2.35844936443632   | 2.40971766105069   occ= 0
MO #62  (B3u #9 ) energy= 2.38408358731198   | 2.35845434360342   | 2.40971283102054   occ= 0
MO #63  (Ag  #16) energy= 5.42588781965941   | 5.42083749836258   | 5.43093814095626   occ= 0
 ** Mulliken pop on meta-lowdin orthogonal AOs  **
 ** Mulliken pop  **
pop of  0 Sc 3s        1.99988
pop of  0 Sc 4s        1.99833
pop of  0 Sc 5s        0.00000
pop of  0 Sc 6s        0.00000
pop of  0 Sc 7s        0.00000
pop of  0 Sc 3px       1.99781
pop of  0 Sc 3py       1.99781
pop of  0 Sc 3pz       1.99833
pop of  0 Sc 4px       0.00083
pop of  0 Sc 4py       0.00083
pop of  0 Sc 4pz       0.00063
pop of  0 Sc 5px       0.00114
pop of  0 Sc 5py       0.00114
pop of  0 Sc 5pz       0.00091
pop of  0 Sc 6px       0.00006
pop of  0 Sc 6py       0.00006
pop of  0 Sc 6pz       0.00007
pop of  0 Sc 7px       0.00003
pop of  0 Sc 7py       0.00003
pop of  0 Sc 7pz       0.00002
pop of  0 Sc 3dxy      0.00000
pop of  0 Sc 3dyz      0.00000
pop of  0 Sc 3dz^2     0.00145
pop of  0 Sc 3dxz      0.00000
pop of  0 Sc 3dx2-y2    0.92126
pop of  0 Sc 4dxy      0.00000
pop of  0 Sc 4dyz      0.00000
pop of  0 Sc 4dz^2     0.00029
pop of  0 Sc 4dxz      0.00000
pop of  0 Sc 4dx2-y2    0.06729
pop of  0 Sc 5dxy      0.00000
pop of  0 Sc 5dyz      0.00000
pop of  0 Sc 5dz^2     0.00004
pop of  0 Sc 5dxz      0.00000
pop of  0 Sc 5dx2-y2    0.00018
pop of  0 Sc 6dxy      0.00000
pop of  0 Sc 6dyz      0.00000
pop of  0 Sc 6dz^2     0.00001
pop of  0 Sc 6dxz      0.00000
pop of  0 Sc 6dx2-y2    0.01127
pop of  0 Sc 4f-3      0.00002
pop of  0 Sc 4f-2      0.00000
pop of  0 Sc 4f-1      0.00000
pop of  0 Sc 4f 0      0.00000
pop of  0 Sc 4f 1      0.00000
pop of  0 Sc 4f 2      0.00000
pop of  0 Sc 4f 3      0.00002
pop of  0 Sc 5f-3      0.00010
pop of  0 Sc 5f-2      0.00000
pop of  0 Sc 5f-1      0.00001
pop of  0 Sc 5f 0      0.00005
pop of  0 Sc 5f 1      0.00001
pop of  0 Sc 5f 2      0.00000
pop of  0 Sc 5f 3      0.00010
pop of  0 Sc 5g-4      0.00000
pop of  0 Sc 5g-3      0.00000
pop of  0 Sc 5g-2      0.00000
pop of  0 Sc 5g-1      0.00000
pop of  0 Sc 5g 0      0.00000
pop of  0 Sc 5g 1      0.00000
pop of  0 Sc 5g 2      0.00000
pop of  0 Sc 5g 3      0.00000
pop of  0 Sc 5g 4      0.00000
 ** Mulliken atomic charges  **
charge of  0Sc =     -0.00000
Dipole moment(X, Y, Z, Debye):  0.00000,  0.00000,  0.00000
Using Python 3.x
Wavefunction successfully saved to QMCPACK HDF5 Format
Use: "convert4qmc -pyscf  scf.h5" to generate QMCPACK input files
